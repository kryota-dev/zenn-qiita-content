---
title: 'Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®äºˆå®šã‚’æ¯æœLINEã«é€šçŸ¥ã™ã‚‹GASã‚’ä½œã£ã¦ã¿ãŸ'
emoji: 'ğŸ—“ï¸'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['gas', 'google', 'line']
published: false
---

## ãªãœä½œã£ãŸã®ã‹

Google ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«äºˆå®šã‚’å…¥ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€ãšã¼ã‚‰ãªè‡ªåˆ†ã¯äºˆå®šã‚’å¿˜ã‚Œã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ ğŸ˜…
ãªã®ã§ã€æ¯æœ LINE ã«äºˆå®šã‚’é€šçŸ¥ã—ã¦ãã‚Œã‚‹ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Œã°ä¾¿åˆ©ã ãªã¨æ€ã„ã€ä½œã£ã¦ã¿ã¾ã—ãŸï¼

## ä½œã£ãŸã‚‚ã®

ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚
![](/images/9e9edd7d76ff7b/image1.png)

## ä½¿ç”¨ã‚µãƒ¼ãƒ“ã‚¹

- Google Apps Script
- Google ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
- LINE Notify
- Todoistï¼ˆè‡ªåˆ†ã¯ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚’ã“ã‚Œã«ã—ã¦ã„ã‚‹ã®ã§ã€ä¸€ç·’ã«é€šçŸ¥ã—ã¦ã‚‚ã‚‰ã†ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ï¼‰

## äº‹å‰æº–å‚™

### LINE Notify

[LINE Notify ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚](https://notify-bot.line.me/my/)
ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ãªã„å ´åˆã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã—ã¾ã™ã€‚
è‡ªåˆ†ã¯ LINE ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã—ã€LINE Notify ã‚’æ‹›å¾…ã—ã¦ã€ãã®ã‚°ãƒ«ãƒ¼ãƒ—ã«é€šçŸ¥ã‚’é€ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ç™ºè¡Œã—ãŸã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã€å¾Œã»ã©ä½¿ã„ã¾ã™ã®ã§ã€ãƒ¡ãƒ¢ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚

### Google ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼

ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ID ã‚’å–å¾—ã—ã¾ã™ã€‚
ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ID ã¯ã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®è¨­å®šã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚
![](/images/9e9edd7d76ff7b/image2.png)
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®å ´åˆã¯ gmail ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ID ã«ãªã‚Šã¾ã™ã€‚
![](/images/9e9edd7d76ff7b/image3.png)

### Google Apps Script

GAS ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼ˆä½œæˆæ–¹æ³•ã¯è‡ªç”±ï¼‰

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ãŸã‚‰ã€å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®æ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é–‹ãã¾ã™ã€‚

ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

- `LINE_NOTIFY_ENDPOINT`
  - LINE Notify ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  - https://notify-api.line.me/api/notify
- `LINE_NOTIFY_PERSONAL_ACCESS_TOKEN`
  - å…ˆã»ã©å–å¾—ã—ãŸ LINE Notify ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³
- `MAIN_CALENDAR_ID`
  - å…ˆã»ã©å–å¾—ã—ãŸã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ID
- `TODOIST_CALENDER_ID`
  - Todoist ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ID

![](/images/9e9edd7d76ff7b/image4.png)

ã“ã‚Œã§æº–å‚™ã¯å®Œäº†ã§ã™ï¼

## å®Ÿè£…

ä»Šå›ã®å®Œæˆã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```js
const main = () => {
  setTrigger()

  const MAIN_CALENDAR_ID = PropertiesService.getScriptProperties().getProperty('MAIN_CALENDAR_ID')
  const TODOIST_CALENDAR_ID = PropertiesService.getScriptProperties().getProperty('TODOIST_CALENDAR_ID')

  const now = new Date()
  const mainEvents = CalendarApp.getCalendarById(MAIN_CALENDAR_ID).getEventsForDay(now)
  const todoistEvents = CalendarApp.getCalendarById(TODOIST_CALENDAR_ID).getEventsForDay(now)

  let eventMessage = ''
  let eventCount = 0
  mainEvents.forEach((event, index) => {
    eventMessage += formatEvent(event, now) + (index !== mainEvents.length - 1 ? '\n' : '')
    eventCount++
  })

  let todoMessage = ''
  let todoCount = 0
  todoistEvents.forEach((event, index) => {
    todoMessage += formatEvent(event, now) + (index !== todoistEvents.length - 1 ? '\n' : '')
    todoCount++
  })

  if (eventCount > 0 || todoCount > 0) {
    const message = `\næœ¬æ—¥ã®äºˆå®šã‚’ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ï¼ˆhttps://calendar.google.com/calendar/u/0/r/dayï¼‰\n\n\`âœ…ToDo (${todoCount})\`\n${todoMessage}\n\n\`ğŸ—“ï¸äºˆå®š (${eventCount})\`\n${eventMessage}`
    sendLineNotify(message)
  }
}

const formatEvent = (event, now) => {
  const timeZone = 'JST'
  const dateFormat = 'M/d'
  const dateTimeFormat = 'HH:mm'

  const startDateTime = event.getStartTime()
  const endDateTime = new Date(event.getEndTime().getTime() - 1) // Subtract 1 millisecond to account for Google Calendar's behavior
  const startDate = Utilities.formatDate(startDateTime, timeZone, dateFormat)
  const endDate = Utilities.formatDate(endDateTime, timeZone, dateFormat)
  const todayDate = Utilities.formatDate(now, timeZone, dateFormat)

  if (event.isAllDayEvent()) {
    if (startDate === endDate) {
      return `*All Day* : ${event.getTitle()}`
    } else {
      return `*All Day (${startDate} - ${endDate})* : ${event.getTitle()}`
    }
  } else {
    const adjustedEndDateTime = new Date(endDateTime.getTime() + 1)
    if (startDate === todayDate && startDate === endDate) {
      return `${Utilities.formatDate(startDateTime, timeZone, dateTimeFormat)} - ${Utilities.formatDate(
        adjustedEndDateTime,
        timeZone,
        dateTimeFormat
      )}: ${event.getTitle()}`
    } else {
      return `${Utilities.formatDate(startDateTime, timeZone, dateTimeFormat)} - ${endDate} ${Utilities.formatDate(
        adjustedEndDateTime,
        timeZone,
        dateTimeFormat
      )}: ${event.getTitle()}`
    }
  }
}

const sendLineNotify = (message) => {
  const LINE_NOTIFY_ENDPOINT = PropertiesService.getScriptProperties().getProperty('LINE_NOTIFY_ENDPOINT')
  const LINE_NOTIFY_PERSONAL_ACCESS_TOKEN = PropertiesService.getScriptProperties().getProperty(
    'LINE_NOTIFY_PERSONAL_ACCESS_TOKEN'
  )

  const options = {
    method: 'POST',
    headers: {
      Authorization: `Bearer ${LINE_NOTIFY_PERSONAL_ACCESS_TOKEN}`,
    },
    payload: {
      message: message,
    },
  }

  UrlFetchApp.fetch(LINE_NOTIFY_ENDPOINT, options)
}

/**
 * Trigger Function
 */
const setTrigger = () => {
  deleteAllTriggers()

  const time = new Date()

  time.setDate(time.getDate() + 1)
  time.setHours(8)
  time.setMinutes(0)
  time.setSeconds(0)
  ScriptApp.newTrigger('main').timeBased().at(time).create()
}

const deleteAllTriggers = () => {
  const allTriggers = ScriptApp.getProjectTriggers()
  allTriggers.forEach((trigger) => {
    ScriptApp.deleteTrigger(trigger)
  })
}
```

é–¢æ•°ã”ã¨ã«èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

### main

ãƒ¡ã‚¤ãƒ³ã®é–¢æ•°ã§ã™ã€‚

ã¾ãšã¯ã€ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šã—ã¾ã™ï¼ˆå¾Œè¿°ï¼‰

æ¬¡ã«ã€å…ˆã»ã©ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«è¨­å®šã—ãŸã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ID ã‚’å–å¾—ã—ã€å®šæ•°ã«æ ¼ç´ã—ã¾ã™ã€‚

```js
const MAIN_CALENDAR_ID = PropertiesService.getScriptProperties().getProperty('MAIN_CALENDAR_ID')
const TODOIST_CALENDAR_ID = PropertiesService.getScriptProperties().getProperty('TODOIST_CALENDAR_ID')
```

æ¬¡ã«ã€ä»Šæ—¥ã®æ—¥ä»˜ã‚’å–å¾—ã—ã€ãã®æ—¥ä»˜ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚

```js
const now = new Date()
const mainEvents = CalendarApp.getCalendarById(MAIN_CALENDAR_ID).getEventsForDay(now)
const todoistEvents = CalendarApp.getCalendarById(TODOIST_CALENDAR_ID).getEventsForDay(now)
```
